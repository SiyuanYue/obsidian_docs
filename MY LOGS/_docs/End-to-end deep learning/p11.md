# End-to-end deep learning
## 端到端学习的兴起 (ch47)

假设你想要构建一个系统来对产品的线上评论进行检查，并且要能够自动地告诉你给出评论的人是否喜欢这个产品。比如说，你希望系统将下面的句子识别为十分正面的评论：

> 这个拖把非常好用！

而下面的评论应当是十分负面的：

> 拖把的质量好差，我后悔买它了。

这种识别正面与负面评论的问题被称为 “情感分类”（sentiment classification） 。想要构建一个这样的系统，你的流水线模块需要有以下两个组件：

1. 解析器（parser）：一种通过识别关键词汇来对文本进行注释的系统。例如，你可以使用解析器对所有的形容词和名词做标记，因此你可能会得到类似下面的句子：

   ​    这个拖把（名词）非常好用（形容词）！

   注：实际上解析器提供了比这更丰富的文本注释，但上面这个简化的描述足以用来解释端到端深度学习。

2. 情感分类器（sentiment classifier）：一种学习算法，它可以输入带注释的文本，并预测整体的情感。解析器的注释将对这个算法起到极大的帮助：通过给形容词一个较高的权重，你的算法将能很快地找到像 “非常” 这样的重要词汇，并忽视像 “这个” 这样的非关键词。

我们可以将 “流水线” 的两个组件可视化为下面的图片：

![](ch47_01.png)

最近的趋势更倾向于用一种单一的学习算法取代此类流水线。该任务的**端到端学习算法**只需输入一个原始的文本 “这个拖把非常好用！” ，接着尝试直接识别其中的情感：

![](ch47_02.png)

神经网络通常用于端到端学习系统，“端到端” 这个术语指的是我们要求学习算法直接从输入得到期望的输出，即学习算法将系统的 “输入端” 连接到 “输出端” 。 

在数据量十分丰富的问题上，端到端系统往往很奏效，但它并不总是一个很好的选择。接下来的几个章节将给出更多的端到端系统的例子，并提供一些关于何时使用它们的建议。

## 端到端学习的更多例子


假设你正在构建一个语音识别系统，你的系统可能需要三个组件：

![](ch48_01.png)

它们的工作形式如下：

1. 计算特征（compute features）：提取人工设计的特征，如 MFCC （Mel-frequency cepstrum coefficients，频谱系数）特征，以此来试图捕捉对话的内容，而忽略不太相关的属性，比如说话者的音高。
2. 音素识别器（phoneme recognizer）：一些语言学家人为，有一些基本的声音单元叫做 “音素” 。例如， “keep” 中的 “k” 和 “cake” 中的 “c” 是相同的音素，而这个系统试图识别音频片段中的音素。
3. 最终识别器（final recognizer）：以已识别音素的序列为序，并试着将它们串在一起，形成转录输出。

与此相反，端到端系统可能会输入一个音频片段，并尝试直接输出文字记录：

![](ch48_02.png)

到目前为止，我们只描述了纯线性的机器学习 “流水线”：输出顺序地从一个阶段传递到下一个阶段。实际上流水线可能会更复杂。例如，这是一个自动驾驶汽车的简单流水线架构：

![](ch48_03.png)

它拥有三个组件：一个使用相机图片检测车辆，一个检测行人，最后一个组件则为我们自己的车规划路径，从而避让车辆和行人。

并不是流水线中的每一个组件都需要进行学习。例如在文献 “robot motion planning” 中对汽车的最终路径规划提出了许多算法，而其中的一些算法并不涉及到学习。

相反，端到端的方法可能会尝试从传感器获取输入并直接输出转向方向：

![](ch48_04.png)

尽管端到端学习已经在许多领域取得了成功，但它并不总是最佳方案。端到端的语音识别功能很不错，但我对自动驾驶的端到端学习持怀疑态度。在接下来的几章将会解释原因。

## 端到端学习的优缺点 (ch49)


考虑先前提到的语音识别系统的流水线：

![](ch48_01.png)

该流水线中的许多部分都是 “人工设计” 的：

- 频谱系数即是一套经过人工设计的特征。尽管它们提供了对音频输入的一种合理归纳，但也通过抛出一些信息简化了输入信号。
- 音素是语言学家的发明，作为说话声音的一种不完备的表示。在某种意义上，音素是对现实语音很差的近似，因此迫使算法使用音素进行表示将限制语音系统的性能。

这些人工设计的成分限制了语音系统的潜在性能，然而这样做也有一些优点：

- 频谱系数的特性对于处理一些不影响内容的音频属性是很有效的，比如说话者的音高。因此它们有助于简化学习算法面临的问题。
- 在一定程度上，音素是一种合理的语音表示方法，它们也可以帮助学习算法理解基本的声音成分，从而提高其性能。

拥有更多的人工设计成分通常可以让语音系统学习更少的数据，由频谱系数和音素所捕获的人工设计的知识对算法从数据中获取的知识进行了补充。当我们的数据量不是很多时，这些知识是非常有用的。

现在，考虑端到端系统：

![](ch48_02.PNG)

这个系统缺乏人工设计知识，因此当训练集很小的时候，它的表现可能比人工设计的流水线更加糟糕。

然而当训练集很大时，它不会受到频谱系数或者语音表示方法的限制。如果学习算法是一个足够大的神经网络，且喂进去许多的训练数据，就有可能做得更好，甚至达到最优错误率。

端到端学习系统在 “两端” —— 输入端和输出端拥有大量标记数据时，往往做得更好。在这个例子中，我们需要一个大数据集（包含<音频, 文本>对）。当这种类型的数据不可用时，使用端到端学习则需非常谨慎。

如果你正在研究一个训练集非常小的机器学习问题，那么算法的大部分知识都将来自于你的人类洞察力，即你的 “人工设计” 成分。

如果不使用端到端系统，你将不得不决定在流水线中需要有哪些组件，以及它们应该如何连接在一起。在接下来的几章中，我们将对这类流水线的设计提出一些建议。

## 流水线组件的选择 ：数据可用性  (CH50)


在构建非端到端的流水线系统时，什么样的流水线组件可作为合适的选项呢？对流水线的设计将极大地影响整个系统的性能，其中一个重要因素是，是否能够轻松地收集到数据来训练每个组件。

例如，考虑下面这个自动驾驶架构：

![](CH48_03.png)

你可以使用机器学习算法进行车辆和行人的检测，另外要获取这些数据也并非难事——如今有许多含有大量带车辆和行人标记的计算机视觉数据集。你也可以通过众包市场（比如  Amazon Mechanical Turk）获得甚至更大规模的数据集。因此，获取训练数据来构建车辆检测器与行人检测器相对而言是比较容易的。

相反，考虑一种纯端到端的方式：

![](CH48_04.png)

为了训练这样一个系统，我们需要一个包含 <图像，操纵方向> 数据对的大型数据集。然而让人们在驾驶汽车时收集汽车的操纵方向的数据是非常费时费力的，你需要一辆特殊配置的汽车，且需要巨大的驾驶量来涵盖各种可能的场景。这就使得端到端系统难以进行训练，获得大量带标记的行人或者是汽车图像反而要容易得多。

更常见的情况是，如果有大量的数据可以被用来训练流水线的 “中间模块” （例如汽车检测器或行人检测器），你便可以考虑使用多段的流水线架构。因为可以使用所有可用数据进行训练，所以这种结构可能是更优的。

在更多端到端数据变得可用之前，我相信非端到端的方法对于自动驾驶而言是更有希望的——它的体系架构更匹配于数据的可用性。

## 流水线组件的选择 ：任务简单性 （ch51）


除了数据可用性之外，你还应该考虑流水线组件选择的第二个因素：独立的组件使得任务简单了多少？你应该尽可能地选择那些易于构建或学习的独立流水线组件，但对一个组件而言， “易于” 学习指的是什么呢？

考虑下面列出的机器学习任务，它们的难度逐级递增：

![](ch51_01.png)

1. 分类判断某张图片是否过度曝光（就像上面这张图片）；
2. 分类判断某张图片拍摄于室内还是室外；
3. 分类判断某张图片中是否有猫；
4. 分类判断某张图片中是否有黑白两色皮毛的猫；
5. 分类判断某张图片中是否有暹罗猫（一种特殊的猫）

这些图像分类任务都属于二分类任务——你需要输入一张图片，输出 0 或者 1. 但列出的前面几个任务看起来 “更易于” 使神经网络进行学习。你将能够通过较少的训练样本来学习更加简单的任务。

对于使问题变得简单或困难的原因，机器学习领域尚未给出一个较好的正式定义。随着深度学习和多层神经网络的兴起，我们有时认为，如果一个任务可以用更少的计算步骤（对应于一个浅的神经网络）来实现，那么相对于需要更多的计算步骤（对应于一个深的神经网络），这个任务就 “更简单” 了。但这些都是非正式的定义。 

> 在信息论中有 “Kolmogorov 复杂度” 的概念，一个学习函数的复杂度是产生该函数的计算机程序的最短长度。然而这一理论概念在人工智能领域几乎没有什么实际的应用。参考： https://en.wikipedia.org/wiki/Kolmogorov_complexity

如果你能够完成一个复杂的任务，并将其分解为更简单的子任务，然后显式编写子任务步骤代码，那么你就会给算法一些先验知识，从而帮助它更有效地学习任务。

![](ch51_03.png)

假设你正在构建一个暹罗猫检测器。下面是一个纯粹的端到端架构：

![](ch51_02.png)
与此相反，你可以分成两个步骤来形成流水线：  

![](ch51_04.png)

第一步：（猫检测器）检测图像中所有的猫。 

![](ch51_05.png)

第二步：将每一块被检测到的猫的图像传送给猫种类分类器（每次一张），如果其中任何一只猫是暹罗猫，则在最后输出 1.  

![](ch51_06.png)

与仅仅使用标签 0/1 来训练一个纯粹的端到端分类器相比，流水线中的两个组件——猫咪检测器和猫种类分类器——似乎更容易进行学习，而且需要更少的数据。 

> 如果你熟悉实际运用中的对象检测算法，你将认识到它们并不是只学习 0/1 图像标签，而是作为训练数据的一部分取代边界框进行训练，对它们的讨论超出了本章的范围。如果你想了解更多关于这种算法的知识，请参阅 Coursera 的 Deep Learning 专项课程（ http://deeplearning.ai ）。 

最后一个例子，让我们回顾一下自动驾驶流水线。

![](ch48_03.png)

通过使用该流水线架构，你可以告诉算法总共有三个关键的步骤：（1）检测其他车辆，（2）检测行人，（3）为你的车规划一条道路。此外，每一个步骤都是相对简单的功能——因此可以用更少的数据来学习——而不是纯粹的端到端方法。

总而言之，当决定流水线组件的内容组成时，试着构建这样的流水线，其中每个组件都是一个相对 “简单” 的功能，因此只需要从少量的数据中学习。  

## 直接学习更为丰富的输出 (ch52)


一个图像分类算法可以输入一个图像 $x$ ，并输出一个表示对象类别的整数。那么一个算法可以输出一个完整的句子来对图像进行描述吗？

举个例子——

输入 $x$ 为：

![](ch52_01.png)

输出 $y$ 为：“一辆黄色的公共汽车在路上开着，背景是绿色的树和绿色的草。 ”

传统的监督学习应用学得一个函数：$h:X \mapsto Y$ ，其中输出 $Y$ 通常是一个整数或者实数。例如：

| 问题         | X              | Y                           |
| ------------ | -------------- | --------------------------- |
| 垃圾邮件分类 | 邮件           | 垃圾邮件/非垃圾邮件 （0/1） |
| 图像识别     | 图像           | 整数值标签                  |
| 房价预测     | 房屋特征       | 美元价格                    |
| 产品推荐     | 产品与用户特征 | 购买机率                    |

端到端深度学习中最令人兴奋的进展之一是，它让我们直接学习比数字复杂得多的 $y$ . 在上面的图像配字示例中，你可以使用一个神经网络输入一个图像（$x$），并直接输出一个标题（$y$）.

下面有更多的例子：

| 问题     | X    | Y    | 文献引用 |
| -------- | ---- | ---- | -------- |
| 图像配字 | 图像 | 文本 |Mao et al., 2014|
| 机器翻译 | 英语文本 | 法语文本 |Mao et al., 2014|
| 问题回答 | （文本，问题）对 | 回答文本 |Bordes et al., 2015|
| 语音识别 | 音频 | 转录 |Hannun et al., 2015|
| 文本转语音 | 文本特征 | 音频 |van der Oord et al., 2016|

这体现了深度学习的高速变化趋势：当你有正确的（输入，输出）标签对的时候，有时可以进行端到端学习，即使输出是一个句子、图像、音频，或者其它的比一个数字更丰富的输出形式。 

 